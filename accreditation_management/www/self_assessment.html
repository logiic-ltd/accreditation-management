{% extends "templates/web.html" %}

{% block page_content %}
<div class="content-wrapper">
    <div class="container">
        <h1 class="mb-4">Self Assessment Form</h1>
        <form id="selfAssessmentForm">
            <div class="form-group">
                <label for="schoolName">School Name</label>
                <input type="text" class="form-control" id="schoolName" name="school_name" required>
            </div>
            <div class="form-group">
                <label for="submissionDate">Submission Date</label>
                <input type="date" class="form-control" id="submissionDate" name="submission_date" required>
            </div>
            {% for i in range(1, 54) %}
            <div class="form-group">
                <label for="indicator{{ i }}">Indicator {{ i }}</label>
                <select class="form-control" id="indicator{{ i }}" name="indicator_{{ i }}">
                    <option value="0">The school has No Strategic Plan</option>
                    <option value="1">The Strategic plan is available with no vision and mission</option>
                    <option value="2">The strategic plan includes clear vision and mission</option>
                    <option value="3">The available strategic plan includes clear vision, mission, and organizational structure</option>
                    <option value="4">The school has a strategic plan that includes clear vision, mission, organizational structure, and budget proposal in strategic plan</option>
                </select>
            </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
</div>

<script>
frappe.ready(function() {
    $('#selfAssessmentForm').on('submit', function(e) {
        e.preventDefault();

        var formData = {};
        $(this).serializeArray().forEach(function(item) {
            formData[item.name] = item.value;
        });

        frappe.call({
            method: 'accreditation_management.www.self_assessment.submit_self_assessment',
            args: {
                form_data: JSON.stringify(formData)
            },
            freeze: true,
            callback: function(r) {
                if (!r.exc) {
                    frappe.msgprint({
                        title: __('Form Submitted'),
                        indicator: 'green',
                        message: __('Your self-assessment form has been submitted successfully.')
                    });
                } else {
                    frappe.msgprint({
                        title: __('Submission Failed'),
                        indicator: 'red',
                        message: __('There was an error submitting your form. Please try again.')
                    });
                }
            }
        });
    });
});
</script>
{% endblock %}
